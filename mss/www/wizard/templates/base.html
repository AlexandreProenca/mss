{% load i18n %}<!DOCTYPE html>
<html>
    <head>
        <title>Mandriva Server Setup</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="{{ MEDIA_URL }}js/jquery-1.8.1.min.js" type="text/javascript"></script>
        <script src="{{ MEDIA_URL }}js/jquery.colorbox-min.js" type="text/javascript"></script>
        <script src="{{ MEDIA_URL }}bootstrap/js/bootstrap.js" type="text/javascript"></script>
        <script src="{{ MEDIA_URL }}js/global.js" type="text/javascript"></script>
        <link href="{{ MEDIA_URL }}bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="{{ MEDIA_URL }}css/mss.css" rel="stylesheet">
        <link href="{{ MEDIA_URL }}bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
        <link href="{{ MEDIA_URL }}css/colorbox.css" rel="stylesheet">
    </head>
    <body data-spy="scroll" data-offset="500" data-target="#sidebar">
        <script type="text/javascript">
            // show/hide log function for install/config pages
            toggleLog = function(button) {
                var button = $(button);
                var log = button.parent().nextAll('.log');
                $(log).slideToggle('fast', function() {
                    if($(this).css('display') == "block") {
                        button.html("{% trans "Hide log" %}");
                    }
                    else {
                        button.html("{% trans "Show log" %}");
                    }
                });
            }

            // launch medias update
            updateMedias = function() {
                $.get('{% url medias_update %}');
            }

            // long polling for status bar
            updateStatus = function(force) {
                $.get('{% url status %}', {'force': force})
                .success(function(status) {
                    // hide status on Ready state
                    if (status.indexOf('{% trans "Ready" %}') === 0) {
                        $('#status').html(status);
                        $('#status').addClass("alert-success");
                        $('#status').removeClass("alert-info");
                        $('#status').removeClass("alert-error");
                        setTimeout('$("#status").slideUp()', 1000);
                    }
                    // show status bar on activity
                    else if (status != "") {
                        $('#status').html('<img src="{{ MEDIA_URL }}img/load-info.gif" />&nbsp;' + status);
                        $('#status').addClass("alert-info");
                        $('#status').removeClass("alert-success");
                        $('#status').removeClass("alert-error");
                        $("#status").slideDown();
                    }
                    // immediately refresh when no error
                    updateStatus(false);
                })
                .error(function(xhr) {
                    $('#status').html(xhr.responseText);
                    // set error style if error
                    $('#status').addClass("alert-error");
                    $('#status').removeClass("alert-success");
                    $('#status').removeClass("alert-info");
                    // refresh every 2s on error
                    setTimeout('updateStatus(false)', 2000);
                    $("#status").slideDown();
                });
            }

            $(document).ready(function() {
                $("[rel=tooltip]").each(function() {
                    $(this).tooltip();
                });
            });
        </script>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a href="/" class="brand">
                        <img src="{{ MEDIA_URL}}img/mandriva-logo-opt.png" />&nbsp;Mandriva Server Setup&nbsp;<small>2.0</small>
                    </a>
                    <div class="nav-collapse">
                        {% if user.is_authenticated %}
                        <ul class="nav pull-right">
                            {% if not main_media %}
                            <li>
                                <form id="mbs-repositories" method="post" action="{% url prepare %}">
                                    <input type="hidden" name="mbs_repo" value="mbs_repo" />
                                </form>
                                <a href="#" onclick="$('#mbs-repositories')[0].submit()" class="error"
                                   data-placement="bottom" rel="tooltip"
                                   data-original-title="{% trans "You don't have the Mandriva Business Server repositories installed. Install them to get security updates." %}"><i class="icon-warning-sign icon-gray"></i>&nbsp;{% trans "Add medias" %}</a>
                            </li>
                            {% else %}
                            <li>
                                <a href="#" data-placement="bottom" rel="tooltip"
                                   data-original-title="{% trans "Update packages list on your server." %}"
                                   onclick="updateMedias(); return false;"><i class="icon-refresh icon-gray"></i>&nbsp;{% trans "Update medias" %}</a>
                            </li>
                            {% endif %}
                            {% if language_form %}
                            <li class="dropdown">
                                <a id="languages" class="dropdown-toggle" data-toggle="dropdown" role="button" href="#">
                                    <i class="icon-flag icon-gray"></i>&nbsp;{% trans "Language" %}<b class="caret"></b>
                                </a>
                                <ul id="languages-menu" class="dropdown-menu" aria-labelledby="languages" role="menu">
                                    {% for lang in LANGUAGES %}
                                        <li><a class="{{ lang.0 }}" href="/mss/lang/{{ lang.0 }}">{{ lang.1 }}</a>
                                    {% endfor %}
                                </ul>
                            </li>
                            {% endif %}
                            <li>
                                <a href="{% url logout %}"><i class="icon-off icon-gray"></i>&nbsp;{% trans "Logout" %}</a>
                            </li>
                        </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid" id="wrapper">
            <div class="row-fluid">
                <div class="span3" id="sidebar">
                    <ul class="nav nav-list affix">
                        {% block sidebar %}{% endblock %}
                    </ul>
                </div>
                <div class="span9">
                    <div id="content" class="content">
                        {% if sections %}
                        <ul class="breadcrumb">
                            {% if section.name %}
                            <li><a href="{% url sections %}">{% trans "Home" %}</a> <span class="divider">/</span></li>
                            <li class="active">{{ section.name }}</li>
                            {% else %}
                            <li class="active">{% trans "Home" %}</li>
                            {% endif %}
                        </ul>
                        {% endif %}
                        {% block content %}{% endblock %}
                    </div>
                </div>
            </div>
        </div>
        <div id="status" class="alert alert-success" style="display: none">{% trans "Ready" %}</div>
    </body>
</html>
